<!DOCTYPE html>
<html lang="ko">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>AnnotationTool</title>
    <script src="js/annotation.js"></script>
    <link rel="stylesheet" href="css/photon.css">

    <style>
        html, body {
            background-color: #DADADA;
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
            position: relative;
        }

        #main {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .no-scroll {
            overflow: hidden;
        }

        .no-show {
            display: none;
        }

        .auto-scroll-v {
            overflow-y: auto;
            height: 100%;
        }

        .labels {
            position: absolute;
            z-index: 0;
            left: 0;
            top: 0;
            color: white;
        }

        .labels > div {
            white-space: nowrap;
            position: absolute;
            left: 0;
            top: 0;
            cursor: pointer;
            font-size: small;
            text-shadow: -1px -1px 0 #000,
            0 -1px 0 #000,
            1px -1px 0 #000,
            1px 0 0 #000,
            1px 1px 0 #000,
            0 1px 0 #000,
            -1px 1px 0 #000,
            -1px 0 0 #000;
        }

        .objects {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 200px;
            max-height: 650px;
            overflow-y: auto;
            background-color: floralwhite;
        }

        .properties {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 300px;
            max-height: 650px;
            overflow-y: auto;
            background-color: aliceblue;
        }

        .selected {
            background-color: #3e9bf4;
        }

        .object_hover {
            border: 1px solid blue;
        }

        .list {
            padding: 5px;
        }

        .object {
            padding-left: 5px;
        }

        .title {
            color: white;
            background-color: #737475;
        }
    </style>
    <style>
        ul, #tree {
            list-style-type: none;
        }

        #tree {
            margin: 0;
            padding: 0;
        }

        .caret {
            cursor: pointer;
            user-select: none
        }

        .caret::before {
            content: "\25B6";
            color: black;
            display: inline-block;
            margin-right: 6px;
        }

        .caret-down::before {
            transform: rotate(90deg);
        }

        .nested {
            display: none;
        }

        .active {
            display: block;
        }

        .has-errors {
            background-color: red;
        }
    </style>
</head>

<body>
<div class="window">
    <header class="toolbar toolbar-header">
        <div class="toolbar-actions">
            <div class="btn-group">
                <button class="btn btn-default" onclick="request_open_project();">
                    <span class="icon icon-folder"></span>
                </button>
                <button class="btn btn-default" onclick="request_save_project();">
                    <span class="icon icon-floppy"></span>
                </button>
            </div>
        </div>
    </header>
    <div class="window-content" tabindex="0">
        <div class="pane-group">
            <div class="pane-sm sidebar" id="side">
                <ul id="tree" class="auto-scroll-v">
                </ul>
            </div>
            <div class="pane no-scroll">
                <canvas id="main"></canvas>
                <div class="labels"></div>
                <div class="objects"></div>
                <div class="properties"></div>
            </div>
        </div>
    </div>
    <footer class="toolbar toolbar-footer">
    </footer>
</div>
<script>

    const application = new MvApplication()

    document.addEventListener('object-blur', event => {
        
    });

    window.onresize = () => {
        application.update()
    }

    const canvas = document.querySelector('#main')
    const labels = document.querySelector('.labels')
    const gl_controller = new GLController(application, canvas, labels)

    const tree = document.querySelector('#tree')
    const objects = document.querySelector('.objects')
    const properties = document.querySelector('.properties')
    const web_controller = new WebController(application, tree, objects, properties)

    function response_open_project(_, files) {
        (async () => {
            application.new_project()
        })().then(() => {
            const project = new MvProject(files)
            application.new_project(project)
        })
    }

    const {ipcRenderer} = require('electron');
    ipcRenderer.on('open-directory', response_open_project);

    function request_open_project() {
        ipcRenderer.send('open-directory');
    }

    function request_save_project() {
        application.save()
    }

    document.addEventListener('save-camera', event => {
        ipcRenderer.send('save-camera', event.detail);
    });

    document.addEventListener('object-blur', event => {
        const window_content = document.querySelector('.window-content')
        window_content.focus()
    });

    let keyMap;
    const keyFile = "data/key.json";
    fetch(keyFile).then(r => r.text()).then(t => {
        keyMap = JSON.parse(t)
        const keyComponent = document.querySelector(".window-content");
        new KeyController(application, keyComponent, keyMap)
    });
</script>

</body>
</html>